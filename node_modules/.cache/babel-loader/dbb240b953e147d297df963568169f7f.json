{"ast":null,"code":"import _slicedToArray from \"/Users/bdougie/code/use-shopping-cart/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"/Users/bdougie/code/use-shopping-cart/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _createForOfIteratorHelper from \"/Users/bdougie/code/use-shopping-cart/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport react, { createContext, useReducer, useEffect, useMemo, useContext } from 'react';\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction unwrapExports(x) {\n  return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nfunction createCommonjsModule(fn, module) {\n  return module = {\n    exports: {}\n  }, fn(module, module.exports), module.exports;\n}\n\nvar common = createCommonjsModule(function (module, exports) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  function fromStorage(value) {\n    return value !== null ? JSON.parse(value) : null;\n  }\n\n  function readItem(storage, key) {\n    try {\n      var storedValue = storage.getItem(key);\n      return fromStorage(storedValue);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  function toStorage(value) {\n    return JSON.stringify(value);\n  }\n\n  function writeItem(storage, key, value) {\n    try {\n      if (value !== null) {\n        storage.setItem(key, toStorage(value));\n      } else {\n        storage.removeItem(key);\n      }\n\n      return Promise.resolve();\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n\n  function useInitialState(storage, key, defaultState) {\n    var defaultStateRef = react.useRef(defaultState);\n    return react.useMemo(function () {\n      var _a;\n\n      return (_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current;\n    }, [key, storage]);\n  }\n\n  exports.useInitialState = useInitialState;\n\n  function useStorageWriter(storage, key, state) {\n    var _a = react.useState(undefined),\n        writeError = _a[0],\n        setWriteError = _a[1];\n\n    react.useEffect(function () {\n      writeItem(storage, key, state).catch(function (error) {\n        if (!error || !error.message || error.message !== (writeError === null || writeError === void 0 ? void 0 : writeError.message)) {\n          setWriteError(error);\n        }\n      });\n\n      if (writeError) {\n        return function () {\n          setWriteError(undefined);\n        };\n      }\n    }, [state, key, writeError, storage]);\n    return writeError;\n  }\n\n  exports.useStorageWriter = useStorageWriter;\n\n  function useStorageListener(storage, key, defaultState, onChange) {\n    var defaultStateRef = react.useRef(defaultState);\n    var onChangeRef = react.useRef(onChange);\n    var firstRun = react.useRef(true);\n    react.useEffect(function () {\n      var _a;\n\n      if (firstRun.current) {\n        firstRun.current = false;\n        return;\n      }\n\n      onChangeRef.current((_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n    }, [key, storage]);\n    react.useEffect(function () {\n      function onStorageChange(event) {\n        var _a;\n\n        if (event.key === key) {\n          onChangeRef.current((_a = fromStorage(event.newValue)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n        }\n      }\n\n      if (typeof window !== 'undefined') {\n        window.addEventListener('storage', onStorageChange);\n        return function () {\n          window.removeEventListener('storage', onStorageChange);\n        };\n      }\n    }, [key]);\n  }\n\n  exports.useStorageListener = useStorageListener;\n});\nunwrapExports(common);\nvar common_1 = common.useInitialState;\nvar common_2 = common.useStorageWriter;\nvar common_3 = common.useStorageListener;\nvar state = createCommonjsModule(function (module, exports) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  function useStorageState(storage, key, defaultState) {\n    if (defaultState === void 0) {\n      defaultState = null;\n    }\n\n    var _a = react.useState(common.useInitialState(storage, key, defaultState)),\n        state = _a[0],\n        setState = _a[1];\n\n    common.useStorageListener(storage, key, defaultState, setState);\n    var writeError = common.useStorageWriter(storage, key, state);\n    return [state, setState, writeError];\n  }\n\n  exports.default = useStorageState;\n});\nunwrapExports(state);\nvar reducer = createCommonjsModule(function (module, exports) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  var FORCE_STATE_ACTION = '__FORCE_STATE_INTERNAL_API__';\n\n  function isForceStateAction(action) {\n    return typeof action === 'object' && action !== null && 'type' in action && action.type === FORCE_STATE_ACTION;\n  }\n\n  function addForceStateActionToReducer(reducer) {\n    return function (state, action) {\n      if (isForceStateAction(action)) return action.payload;\n      return reducer(state, action);\n    };\n  }\n\n  function useStorageReducer(storage, key, reducer, defaultInitialArg, defaultInit) {\n    if (defaultInit === void 0) {\n      defaultInit = function defaultInit(x) {\n        return x;\n      };\n    }\n\n    var defaultState = defaultInit(defaultInitialArg);\n\n    var _a = react.useReducer(addForceStateActionToReducer(reducer), common.useInitialState(storage, key, defaultState)),\n        state = _a[0],\n        dispatch = _a[1];\n\n    common.useStorageListener(storage, key, defaultState, function (newValue) {\n      dispatch({\n        type: FORCE_STATE_ACTION,\n        payload: newValue\n      });\n    });\n    var writeError = common.useStorageWriter(storage, key, state);\n    return [state, dispatch, writeError];\n  }\n\n  exports.default = useStorageReducer;\n});\nunwrapExports(reducer);\nvar dist = createCommonjsModule(function (module, exports) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.useStorageState = state.default;\n  exports.useStorageReducer = reducer.default;\n});\nunwrapExports(dist);\nvar dist_1 = dist.useStorageState;\nvar dist_2 = dist.useStorageReducer;\nvar isClient = typeof window === 'object';\n\nvar formatCurrencyString = _ref => {\n  var value = _ref.value,\n      currency = _ref.currency,\n      _ref$language = _ref.language,\n      language = _ref$language === void 0 ? isClient ? navigator.language : 'en-US' : _ref$language;\n  value = parseInt(value);\n  var numberFormat = new Intl.NumberFormat(language, {\n    style: 'currency',\n    currency,\n    currencyDisplay: 'symbol'\n  });\n  var parts = numberFormat.formatToParts(value);\n  var zeroDecimalCurrency = true;\n\n  var _iterator = _createForOfIteratorHelper(parts),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var part = _step.value;\n\n      if (part.type === 'decimal') {\n        zeroDecimalCurrency = false;\n        break;\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  value = zeroDecimalCurrency ? value : value / 100;\n  return numberFormat.format(value.toFixed(2));\n};\n\nfunction useLocalStorageReducer(key, reducer, initialState) {\n  var dummyStorage = {\n    getItem() {\n      return null;\n    },\n\n    setItem() {},\n\n    removeItem() {}\n\n  };\n  return dist_2(isClient ? window.localStorage : dummyStorage, key, reducer, initialState);\n}\n\nvar getCheckoutData = {\n  stripe(cart) {\n    var _cart$allowedCountrie;\n\n    var lineItems = [];\n\n    for (var sku in cart.cartDetails) {\n      lineItems.push({\n        price: sku,\n        quantity: cart.cartDetails[sku].quantity\n      });\n    }\n\n    var options = {\n      mode: 'payment',\n      lineItems,\n      successUrl: cart.successUrl,\n      cancelUrl: cart.cancelUrl,\n      billingAddressCollection: cart.billingAddressCollection ? 'required' : 'auto',\n      submitType: 'auto'\n    };\n\n    if ((_cart$allowedCountrie = cart.allowedCountries) === null || _cart$allowedCountrie === void 0 ? void 0 : _cart$allowedCountrie.length) {\n      options.shippingAddressCollection = {\n        allowedCountries: cart.allowedCountries\n      };\n    }\n\n    return options;\n  }\n\n};\n\nfunction checkoutHandler(cart, checkoutOptions) {\n  var serviceProperty = '';\n  if (cart.stripe) serviceProperty = 'stripe';\n  var needsCheckoutData = cart.mode === 'client-only';\n  return /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(parameters) {\n      var options, _yield$checkoutOption, error;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            if (serviceProperty) {\n              _context.next = 2;\n              break;\n            }\n\n            throw new Error('No compatible API has been defined, your options are: Stripe');\n\n          case 2:\n            if (checkoutOptions.modes.includes(cart.mode)) {\n              _context.next = 4;\n              break;\n            }\n\n            throw new Error(\"Invalid checkout mode '\".concat(cart.mode, \"' was chosen. The valid modes are \").concat(new Intl.ListFormat().format(checkoutOptions.modes), \".\"));\n\n          case 4:\n            options = {\n              sessionId: parameters === null || parameters === void 0 ? void 0 : parameters.sessionId\n            };\n            if (needsCheckoutData) options = getCheckoutData.stripe(cart);\n            _context.t0 = checkoutOptions;\n            _context.t1 = serviceProperty;\n            _context.next = 10;\n            return cart[serviceProperty];\n\n          case 10:\n            _context.t2 = _context.sent;\n            _context.t3 = options;\n            _context.t4 = parameters;\n            _context.next = 15;\n            return _context.t0[_context.t1].call(_context.t0, _context.t2, _context.t3, _context.t4);\n\n          case 15:\n            _yield$checkoutOption = _context.sent;\n            error = _yield$checkoutOption.error;\n\n            if (!error) {\n              _context.next = 19;\n              break;\n            }\n\n            return _context.abrupt(\"return\", error);\n\n          case 19:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n}\n\nvar cartInitialState = {\n  lastClicked: '',\n  shouldDisplayCart: false,\n  stripe: null\n};\n\nfunction cartReducer(cart, action) {\n  switch (action.type) {\n    case 'store-last-clicked':\n      return _objectSpread2(_objectSpread2({}, cart), {}, {\n        lastClicked: action.sku\n      });\n\n    case 'cart-click':\n      return _objectSpread2(_objectSpread2({}, cart), {}, {\n        shouldDisplayCart: !cart.shouldDisplayCart\n      });\n\n    case 'cart-hover':\n      return _objectSpread2(_objectSpread2({}, cart), {}, {\n        shouldDisplayCart: true\n      });\n\n    case 'close-cart':\n      return _objectSpread2(_objectSpread2({}, cart), {}, {\n        shouldDisplayCart: false\n      });\n\n    case 'stripe-changed':\n      return _objectSpread2(_objectSpread2({}, cart), {}, {\n        stripe: action.stripe\n      });\n\n    default:\n      return cart;\n  }\n}\n\nvar cartValuesInitialState = {\n  cartDetails: {},\n  totalPrice: 0,\n  cartCount: 0\n};\n\nfunction Entry(productData, quantity, currency, language) {\n  return _objectSpread2(_objectSpread2({}, productData), {}, {\n    quantity,\n\n    get value() {\n      return this.price * this.quantity;\n    },\n\n    get formattedValue() {\n      return formatCurrencyString({\n        value: this.value,\n        currency,\n        language\n      });\n    }\n\n  });\n}\n\nfunction cartValuesReducer(state, action) {\n  function createEntry(product, count) {\n    var entry = Entry(product, count, action.currency, action.language);\n    return {\n      cartDetails: _objectSpread2(_objectSpread2({}, state.cartDetails), {}, {\n        [product.sku]: entry\n      }),\n      totalPrice: state.totalPrice + product.price * count,\n      cartCount: state.cartCount + count\n    };\n  }\n\n  function updateEntry(sku, count) {\n    var cartDetails = _objectSpread2({}, state.cartDetails);\n\n    var entry = cartDetails[sku];\n    if (entry.quantity + count <= 0) return removeEntry(sku);\n    cartDetails[sku] = Entry(entry, entry.quantity + count, action.currency, action.language);\n    return {\n      cartDetails,\n      totalPrice: state.totalPrice + entry.price * count,\n      cartCount: state.cartCount + count\n    };\n  }\n\n  function removeEntry(sku) {\n    var cartDetails = _objectSpread2({}, state.cartDetails);\n\n    var totalPrice = state.totalPrice - cartDetails[sku].value;\n    var cartCount = state.cartCount - cartDetails[sku].quantity;\n    delete cartDetails[sku];\n    return {\n      cartDetails,\n      totalPrice,\n      cartCount\n    };\n  }\n\n  function updateQuantity(sku, quantity) {\n    var entry = state.cartDetails[sku];\n    return updateEntry(sku, quantity - entry.quantity);\n  }\n\n  switch (action.type) {\n    case 'add-item-to-cart':\n      if (action.count <= 0) break;\n      if (action.product.sku in state.cartDetails) return updateEntry(action.product.sku, action.count);\n      return createEntry(action.product, action.count);\n\n    case 'increment-item':\n      if (action.count <= 0) break;\n      if (action.sku in state.cartDetails) return updateEntry(action.sku, action.count);\n      break;\n\n    case 'decrement-item':\n      if (action.count <= 0) break;\n      if (action.sku in state.cartDetails) return updateEntry(action.sku, -action.count);\n      break;\n\n    case 'set-item-quantity':\n      if (action.count < 0) break;\n      if (action.sku in state.cartDetails) return updateQuantity(action.sku, action.quantity);\n      break;\n\n    case 'remove-item-from-cart':\n      if (action.sku in state.cartDetails) return removeEntry(action.sku);\n      break;\n\n    case 'clear-cart':\n      return cartValuesInitialState;\n\n    default:\n      return state;\n  }\n\n  console.warn('Invalid action arguments', action);\n  return state;\n}\n\nvar CartContext = /*#__PURE__*/createContext([_objectSpread2({\n  lastClicked: '',\n  shouldDisplayCart: false\n}, cartValuesInitialState), () => {}]);\n\nvar CartProvider = _ref => {\n  var children = _ref.children,\n      mode = _ref.mode,\n      stripe = _ref.stripe,\n      successUrl = _ref.successUrl,\n      cancelUrl = _ref.cancelUrl,\n      currency = _ref.currency,\n      _ref$language2 = _ref.language,\n      language = _ref$language2 === void 0 ? isClient ? navigator.language : 'en-US' : _ref$language2,\n      _ref$billingAddressCo = _ref.billingAddressCollection,\n      billingAddressCollection = _ref$billingAddressCo === void 0 ? false : _ref$billingAddressCo,\n      _ref$allowedCountries = _ref.allowedCountries,\n      allowedCountries = _ref$allowedCountries === void 0 ? null : _ref$allowedCountries;\n\n  var _useReducer = useReducer(cartReducer, cartInitialState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      cart = _useReducer2[0],\n      cartDispatch = _useReducer2[1];\n\n  useEffect(() => {\n    cartDispatch({\n      type: 'stripe-changed',\n      stripe\n    });\n  }, [stripe]);\n\n  var _useLocalStorageReduc = useLocalStorageReducer('cart-values', cartValuesReducer, cartValuesInitialState),\n      _useLocalStorageReduc2 = _slicedToArray(_useLocalStorageReduc, 2),\n      cartValues = _useLocalStorageReduc2[0],\n      cartValuesDispatch = _useLocalStorageReduc2[1]; // combine dispatches and\n  // memoize context value to avoid causing re-renders\n\n\n  var contextValue = useMemo(() => [_objectSpread2(_objectSpread2(_objectSpread2({}, cart), cartValues), {}, {\n    mode,\n    successUrl,\n    cancelUrl,\n    currency,\n    language,\n    billingAddressCollection,\n    allowedCountries\n  }), action => {\n    cartDispatch(action);\n    cartValuesDispatch(_objectSpread2(_objectSpread2({}, action), {}, {\n      currency,\n      language\n    }));\n  }], [cart, cartDispatch, cartValues, cartValuesDispatch, mode, successUrl, cancelUrl, currency, language, billingAddressCollection, allowedCountries]);\n  return /*#__PURE__*/react.createElement(CartContext.Provider, {\n    value: contextValue\n  }, children);\n};\n\nvar useShoppingCart = () => {\n  var _useContext = useContext(CartContext),\n      _useContext2 = _slicedToArray(_useContext, 2),\n      cart = _useContext2[0],\n      dispatch = _useContext2[1];\n\n  var lastClicked = cart.lastClicked,\n      shouldDisplayCart = cart.shouldDisplayCart,\n      cartCount = cart.cartCount,\n      cartDetails = cart.cartDetails,\n      totalPrice = cart.totalPrice,\n      currency = cart.currency,\n      language = cart.language;\n\n  var addItem = function addItem(product) {\n    var count = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return dispatch({\n      type: 'add-item-to-cart',\n      product,\n      count\n    });\n  };\n\n  var removeItem = sku => dispatch({\n    type: 'remove-item-from-cart',\n    sku\n  });\n\n  var setItemQuantity = (sku, quantity) => dispatch({\n    type: 'set-item-quantity',\n    sku,\n    quantity\n  });\n\n  var incrementItem = function incrementItem(sku) {\n    var count = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return dispatch({\n      type: 'increment-item',\n      sku,\n      count\n    });\n  };\n\n  var decrementItem = function decrementItem(sku) {\n    var count = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return dispatch({\n      type: 'decrement-item',\n      sku,\n      count\n    });\n  };\n\n  var clearCart = () => dispatch({\n    type: 'clear-cart'\n  });\n\n  var storeLastClicked = sku => dispatch({\n    type: 'store-last-clicked',\n    sku\n  });\n\n  var handleCartClick = () => dispatch({\n    type: 'cart-click'\n  });\n\n  var handleCartHover = () => dispatch({\n    type: 'cart-hover'\n  });\n\n  var handleCloseCart = () => dispatch({\n    type: 'close-cart'\n  });\n\n  var redirectToCheckout = checkoutHandler(cart, {\n    modes: ['client-only', 'checkout-session'],\n\n    stripe(stripe, options) {\n      return stripe.redirectToCheckout(options);\n    }\n\n  });\n  var checkoutSingleItem = checkoutHandler(cart, {\n    modes: ['client-only'],\n\n    stripe(stripe, options, _ref2) {\n      var sku = _ref2.sku,\n          _ref2$quantity = _ref2.quantity,\n          quantity = _ref2$quantity === void 0 ? 1 : _ref2$quantity;\n      options.lineItems = [{\n        price: sku,\n        quantity\n      }];\n      return stripe.redirectToCheckout(options);\n    }\n\n  });\n  return {\n    cartDetails,\n    cartCount,\n    totalPrice,\n\n    get formattedTotalPrice() {\n      return formatCurrencyString({\n        value: totalPrice,\n        currency,\n        language\n      });\n    },\n\n    addItem,\n    removeItem,\n    setItemQuantity,\n    incrementItem,\n    decrementItem,\n    clearCart,\n    lastClicked,\n    storeLastClicked,\n    shouldDisplayCart,\n    handleCartClick,\n    handleCartHover,\n    handleCloseCart,\n    redirectToCheckout,\n    checkoutSingleItem\n  };\n};\n\nexport { CartContext, CartProvider, formatCurrencyString, isClient, useShoppingCart };","map":{"version":3,"sources":["../../node_modules/react-storage-hooks/dist/common.js","../../node_modules/react-storage-hooks/dist/state.js","../../node_modules/react-storage-hooks/dist/reducer.js","../../node_modules/react-storage-hooks/dist/index.js","../src/util.js","../src/reducers.js","../src/index.js"],"names":["react_1","common_1","isClient","formatCurrencyString","language","navigator","value","parseInt","numberFormat","Intl","style","currencyDisplay","parts","zeroDecimalCurrency","part","dummyStorage","getItem","setItem","removeItem","useStorageReducer","window","getCheckoutData","stripe","lineItems","cart","price","quantity","options","mode","successUrl","cancelUrl","billingAddressCollection","submitType","allowedCountries","serviceProperty","needsCheckoutData","checkoutOptions","sessionId","parameters","error","cartInitialState","lastClicked","shouldDisplayCart","action","sku","cartValuesInitialState","cartDetails","totalPrice","cartCount","entry","Entry","state","product","count","removeEntry","updateEntry","createEntry","updateQuantity","console","CartContext","createContext","CartProvider","useReducer","useEffect","cartDispatch","type","useLocalStorageReducer","contextValue","useMemo","cartValuesDispatch","useShoppingCart","useContext","addItem","dispatch","setItemQuantity","incrementItem","decrementItem","clearCart","storeLastClicked","handleCartClick","handleCartHover","handleCloseCart","redirectToCheckout","checkoutHandler","modes","checkoutSingleItem"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = require(\"react\");\nfunction fromStorage(value) {\n    return value !== null ? JSON.parse(value) : null;\n}\nfunction readItem(storage, key) {\n    try {\n        var storedValue = storage.getItem(key);\n        return fromStorage(storedValue);\n    }\n    catch (e) {\n        return null;\n    }\n}\nfunction toStorage(value) {\n    return JSON.stringify(value);\n}\nfunction writeItem(storage, key, value) {\n    try {\n        if (value !== null) {\n            storage.setItem(key, toStorage(value));\n        }\n        else {\n            storage.removeItem(key);\n        }\n        return Promise.resolve();\n    }\n    catch (error) {\n        return Promise.reject(error);\n    }\n}\nfunction useInitialState(storage, key, defaultState) {\n    var defaultStateRef = react_1.useRef(defaultState);\n    return react_1.useMemo(function () { var _a; return (_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current; }, [\n        key,\n        storage,\n    ]);\n}\nexports.useInitialState = useInitialState;\nfunction useStorageWriter(storage, key, state) {\n    var _a = react_1.useState(undefined), writeError = _a[0], setWriteError = _a[1];\n    react_1.useEffect(function () {\n        writeItem(storage, key, state).catch(function (error) {\n            if (!error || !error.message || error.message !== (writeError === null || writeError === void 0 ? void 0 : writeError.message)) {\n                setWriteError(error);\n            }\n        });\n        if (writeError) {\n            return function () {\n                setWriteError(undefined);\n            };\n        }\n    }, [state, key, writeError, storage]);\n    return writeError;\n}\nexports.useStorageWriter = useStorageWriter;\nfunction useStorageListener(storage, key, defaultState, onChange) {\n    var defaultStateRef = react_1.useRef(defaultState);\n    var onChangeRef = react_1.useRef(onChange);\n    var firstRun = react_1.useRef(true);\n    react_1.useEffect(function () {\n        var _a;\n        if (firstRun.current) {\n            firstRun.current = false;\n            return;\n        }\n        onChangeRef.current((_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n    }, [key, storage]);\n    react_1.useEffect(function () {\n        function onStorageChange(event) {\n            var _a;\n            if (event.key === key) {\n                onChangeRef.current((_a = fromStorage(event.newValue)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n            }\n        }\n        if (typeof window !== 'undefined') {\n            window.addEventListener('storage', onStorageChange);\n            return function () {\n                window.removeEventListener('storage', onStorageChange);\n            };\n        }\n    }, [key]);\n}\nexports.useStorageListener = useStorageListener;\n//# sourceMappingURL=common.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = require(\"react\");\nvar common_1 = require(\"./common\");\nfunction useStorageState(storage, key, defaultState) {\n    if (defaultState === void 0) { defaultState = null; }\n    var _a = react_1.useState(common_1.useInitialState(storage, key, defaultState)), state = _a[0], setState = _a[1];\n    common_1.useStorageListener(storage, key, defaultState, setState);\n    var writeError = common_1.useStorageWriter(storage, key, state);\n    return [state, setState, writeError];\n}\nexports.default = useStorageState;\n//# sourceMappingURL=state.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = require(\"react\");\nvar common_1 = require(\"./common\");\nvar FORCE_STATE_ACTION = '__FORCE_STATE_INTERNAL_API__';\nfunction isForceStateAction(action) {\n    return (typeof action === 'object' &&\n        action !== null &&\n        'type' in action &&\n        action.type === FORCE_STATE_ACTION);\n}\nfunction addForceStateActionToReducer(reducer) {\n    return function (state, action) {\n        if (isForceStateAction(action))\n            return action.payload;\n        return reducer(state, action);\n    };\n}\nfunction useStorageReducer(storage, key, reducer, defaultInitialArg, defaultInit) {\n    if (defaultInit === void 0) { defaultInit = function (x) { return x; }; }\n    var defaultState = defaultInit(defaultInitialArg);\n    var _a = react_1.useReducer(addForceStateActionToReducer(reducer), common_1.useInitialState(storage, key, defaultState)), state = _a[0], dispatch = _a[1];\n    common_1.useStorageListener(storage, key, defaultState, function (newValue) {\n        dispatch({ type: FORCE_STATE_ACTION, payload: newValue });\n    });\n    var writeError = common_1.useStorageWriter(storage, key, state);\n    return [state, dispatch, writeError];\n}\nexports.default = useStorageReducer;\n//# sourceMappingURL=reducer.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar state_1 = require(\"./state\");\nexports.useStorageState = state_1.default;\nvar reducer_1 = require(\"./reducer\");\nexports.useStorageReducer = reducer_1.default;\n//# sourceMappingURL=index.js.map","import { useStorageReducer } from 'react-storage-hooks'\r\n\r\nexport const isClient = typeof window === 'object'\r\n\r\nexport const formatCurrencyString = ({\r\n  value,\r\n  currency,\r\n  language = isClient ? navigator.language : 'en-US'\r\n}) => {\r\n  value = parseInt(value)\r\n  const numberFormat = new Intl.NumberFormat(language, {\r\n    style: 'currency',\r\n    currency,\r\n    currencyDisplay: 'symbol'\r\n  })\r\n  const parts = numberFormat.formatToParts(value)\r\n  let zeroDecimalCurrency = true\r\n\r\n  for (const part of parts) {\r\n    if (part.type === 'decimal') {\r\n      zeroDecimalCurrency = false\r\n      break\r\n    }\r\n  }\r\n\r\n  value = zeroDecimalCurrency ? value : value / 100\r\n  return numberFormat.format(value.toFixed(2))\r\n}\r\n\r\nexport function useLocalStorageReducer(key, reducer, initialState) {\r\n  const dummyStorage = {\r\n    getItem() {\r\n      return null\r\n    },\r\n    setItem() {},\r\n    removeItem() {}\r\n  }\r\n  return useStorageReducer(\r\n    isClient ? window.localStorage : dummyStorage,\r\n    key,\r\n    reducer,\r\n    initialState\r\n  )\r\n}\r\n\r\nexport const getCheckoutData = {\r\n  stripe(cart) {\r\n    const lineItems = []\r\n    for (const sku in cart.cartDetails)\r\n      lineItems.push({ price: sku, quantity: cart.cartDetails[sku].quantity })\r\n\r\n    const options = {\r\n      mode: 'payment',\r\n      lineItems,\r\n      successUrl: cart.successUrl,\r\n      cancelUrl: cart.cancelUrl,\r\n      billingAddressCollection: cart.billingAddressCollection\r\n        ? 'required'\r\n        : 'auto',\r\n      submitType: 'auto'\r\n    }\r\n\r\n    if (cart.allowedCountries?.length) {\r\n      options.shippingAddressCollection = {\r\n        allowedCountries: cart.allowedCountries\r\n      }\r\n    }\r\n\r\n    return options\r\n  }\r\n}\r\n\r\nexport function checkoutHandler(cart, checkoutOptions) {\r\n  let serviceProperty = ''\r\n  if (cart.stripe) serviceProperty = 'stripe'\r\n\r\n  const needsCheckoutData = cart.mode === 'client-only'\r\n\r\n  return async function (parameters) {\r\n    if (!serviceProperty) {\r\n      throw new Error(\r\n        'No compatible API has been defined, your options are: Stripe'\r\n      )\r\n    }\r\n\r\n    if (!checkoutOptions.modes.includes(cart.mode)) {\r\n      throw new Error(\r\n        `Invalid checkout mode '${\r\n          cart.mode\r\n        }' was chosen. The valid modes are ${new Intl.ListFormat().format(\r\n          checkoutOptions.modes\r\n        )}.`\r\n      )\r\n    }\r\n\r\n    let options = { sessionId: parameters?.sessionId }\r\n    if (needsCheckoutData) options = getCheckoutData.stripe(cart)\r\n\r\n    const { error } = await checkoutOptions[serviceProperty](\r\n      await cart[serviceProperty],\r\n      options,\r\n      parameters\r\n    )\r\n    if (error) return error\r\n  }\r\n}\r\n","import { formatCurrencyString } from './util'\r\n\r\nexport const cartInitialState = {\r\n  lastClicked: '',\r\n  shouldDisplayCart: false,\r\n  stripe: null\r\n}\r\nexport function cartReducer(cart, action) {\r\n  switch (action.type) {\r\n    case 'store-last-clicked':\r\n      return {\r\n        ...cart,\r\n        lastClicked: action.sku\r\n      }\r\n\r\n    case 'cart-click':\r\n      return {\r\n        ...cart,\r\n        shouldDisplayCart: !cart.shouldDisplayCart\r\n      }\r\n\r\n    case 'cart-hover':\r\n      return {\r\n        ...cart,\r\n        shouldDisplayCart: true\r\n      }\r\n\r\n    case 'close-cart':\r\n      return {\r\n        ...cart,\r\n        shouldDisplayCart: false\r\n      }\r\n\r\n    case 'stripe-changed':\r\n      return {\r\n        ...cart,\r\n        stripe: action.stripe\r\n      }\r\n\r\n    default:\r\n      return cart\r\n  }\r\n}\r\n\r\nexport const cartValuesInitialState = {\r\n  cartDetails: {},\r\n  totalPrice: 0,\r\n  cartCount: 0\r\n}\r\nfunction Entry(productData, quantity, currency, language) {\r\n  return {\r\n    ...productData,\r\n    quantity,\r\n    get value() {\r\n      return this.price * this.quantity\r\n    },\r\n    get formattedValue() {\r\n      return formatCurrencyString({\r\n        value: this.value,\r\n        currency,\r\n        language\r\n      })\r\n    }\r\n  }\r\n}\r\nexport function cartValuesReducer(state, action) {\r\n  function createEntry(product, count) {\r\n    const entry = Entry(product, count, action.currency, action.language)\r\n\r\n    return {\r\n      cartDetails: {\r\n        ...state.cartDetails,\r\n        [product.sku]: entry\r\n      },\r\n      totalPrice: state.totalPrice + product.price * count,\r\n      cartCount: state.cartCount + count\r\n    }\r\n  }\r\n  function updateEntry(sku, count) {\r\n    const cartDetails = { ...state.cartDetails }\r\n    const entry = cartDetails[sku]\r\n    if (entry.quantity + count <= 0) return removeEntry(sku)\r\n\r\n    cartDetails[sku] = Entry(\r\n      entry,\r\n      entry.quantity + count,\r\n      action.currency,\r\n      action.language\r\n    )\r\n\r\n    return {\r\n      cartDetails,\r\n      totalPrice: state.totalPrice + entry.price * count,\r\n      cartCount: state.cartCount + count\r\n    }\r\n  }\r\n  function removeEntry(sku) {\r\n    const cartDetails = { ...state.cartDetails }\r\n    const totalPrice = state.totalPrice - cartDetails[sku].value\r\n    const cartCount = state.cartCount - cartDetails[sku].quantity\r\n    delete cartDetails[sku]\r\n\r\n    return { cartDetails, totalPrice, cartCount }\r\n  }\r\n  function updateQuantity(sku, quantity) {\r\n    const entry = state.cartDetails[sku]\r\n    return updateEntry(sku, quantity - entry.quantity)\r\n  }\r\n\r\n  switch (action.type) {\r\n    case 'add-item-to-cart':\r\n      if (action.count <= 0) break\r\n      if (action.product.sku in state.cartDetails)\r\n        return updateEntry(action.product.sku, action.count)\r\n      return createEntry(action.product, action.count)\r\n\r\n    case 'increment-item':\r\n      if (action.count <= 0) break\r\n      if (action.sku in state.cartDetails)\r\n        return updateEntry(action.sku, action.count)\r\n      break\r\n\r\n    case 'decrement-item':\r\n      if (action.count <= 0) break\r\n      if (action.sku in state.cartDetails)\r\n        return updateEntry(action.sku, -action.count)\r\n      break\r\n\r\n    case 'set-item-quantity':\r\n      if (action.count < 0) break\r\n      if (action.sku in state.cartDetails)\r\n        return updateQuantity(action.sku, action.quantity)\r\n      break\r\n\r\n    case 'remove-item-from-cart':\r\n      if (action.sku in state.cartDetails) return removeEntry(action.sku)\r\n      break\r\n\r\n    case 'clear-cart':\r\n      return cartValuesInitialState\r\n\r\n    default:\r\n      return state\r\n  }\r\n\r\n  console.warn('Invalid action arguments', action)\r\n  return state\r\n}\r\n","import React, {\r\n  createContext,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useReducer\r\n} from 'react'\r\n\r\nimport {\r\n  checkoutHandler,\r\n  formatCurrencyString,\r\n  isClient,\r\n  useLocalStorageReducer\r\n} from './util'\r\nimport {\r\n  cartInitialState,\r\n  cartReducer,\r\n  cartValuesInitialState,\r\n  cartValuesReducer\r\n} from './reducers'\r\n\r\nexport { formatCurrencyString, isClient } from './util'\r\n\r\nexport const CartContext = createContext([\r\n  {\r\n    lastClicked: '',\r\n    shouldDisplayCart: false,\r\n    ...cartValuesInitialState\r\n  },\r\n  () => {}\r\n])\r\n\r\nexport const CartProvider = ({\r\n  children,\r\n  mode,\r\n  stripe,\r\n  successUrl,\r\n  cancelUrl,\r\n  currency,\r\n  language = isClient ? navigator.language : 'en-US',\r\n  billingAddressCollection = false,\r\n  allowedCountries = null\r\n}) => {\r\n  const [cart, cartDispatch] = useReducer(cartReducer, cartInitialState)\r\n\r\n  useEffect(() => {\r\n    cartDispatch({ type: 'stripe-changed', stripe })\r\n  }, [stripe])\r\n\r\n  const [cartValues, cartValuesDispatch] = useLocalStorageReducer(\r\n    'cart-values',\r\n    cartValuesReducer,\r\n    cartValuesInitialState\r\n  )\r\n\r\n  // combine dispatches and\r\n  // memoize context value to avoid causing re-renders\r\n  const contextValue = useMemo(\r\n    () => [\r\n      {\r\n        ...cart,\r\n        ...cartValues,\r\n        mode,\r\n        successUrl,\r\n        cancelUrl,\r\n        currency,\r\n        language,\r\n        billingAddressCollection,\r\n        allowedCountries\r\n      },\r\n      (action) => {\r\n        cartDispatch(action)\r\n        cartValuesDispatch({ ...action, currency, language })\r\n      }\r\n    ],\r\n    [\r\n      cart,\r\n      cartDispatch,\r\n      cartValues,\r\n      cartValuesDispatch,\r\n      mode,\r\n      successUrl,\r\n      cancelUrl,\r\n      currency,\r\n      language,\r\n      billingAddressCollection,\r\n      allowedCountries\r\n    ]\r\n  )\r\n\r\n  return (\r\n    <CartContext.Provider value={contextValue}>{children}</CartContext.Provider>\r\n  )\r\n}\r\n\r\nexport const useShoppingCart = () => {\r\n  const [cart, dispatch] = useContext(CartContext)\r\n\r\n  const {\r\n    lastClicked,\r\n    shouldDisplayCart,\r\n    cartCount,\r\n    cartDetails,\r\n    totalPrice,\r\n    currency,\r\n    language\r\n  } = cart\r\n\r\n  const addItem = (product, count = 1) =>\r\n    dispatch({ type: 'add-item-to-cart', product, count })\r\n  const removeItem = (sku) => dispatch({ type: 'remove-item-from-cart', sku })\r\n  const setItemQuantity = (sku, quantity) =>\r\n    dispatch({ type: 'set-item-quantity', sku, quantity })\r\n  const incrementItem = (sku, count = 1) =>\r\n    dispatch({ type: 'increment-item', sku, count })\r\n  const decrementItem = (sku, count = 1) =>\r\n    dispatch({ type: 'decrement-item', sku, count })\r\n  const clearCart = () => dispatch({ type: 'clear-cart' })\r\n\r\n  const storeLastClicked = (sku) =>\r\n    dispatch({ type: 'store-last-clicked', sku })\r\n  const handleCartClick = () => dispatch({ type: 'cart-click' })\r\n  const handleCartHover = () => dispatch({ type: 'cart-hover' })\r\n  const handleCloseCart = () => dispatch({ type: 'close-cart' })\r\n\r\n  const redirectToCheckout = checkoutHandler(cart, {\r\n    modes: ['client-only', 'checkout-session'],\r\n    stripe(stripe, options) {\r\n      return stripe.redirectToCheckout(options)\r\n    }\r\n  })\r\n\r\n  const checkoutSingleItem = checkoutHandler(cart, {\r\n    modes: ['client-only'],\r\n    stripe(stripe, options, { sku, quantity = 1 }) {\r\n      options.lineItems = [{ price: sku, quantity }]\r\n      return stripe.redirectToCheckout(options)\r\n    }\r\n  })\r\n\r\n  return {\r\n    cartDetails,\r\n    cartCount,\r\n    totalPrice,\r\n    get formattedTotalPrice() {\r\n      return formatCurrencyString({\r\n        value: totalPrice,\r\n        currency,\r\n        language\r\n      })\r\n    },\r\n\r\n    addItem,\r\n    removeItem,\r\n    setItemQuantity,\r\n    incrementItem,\r\n    decrementItem,\r\n    clearCart,\r\n\r\n    lastClicked,\r\n    storeLastClicked,\r\n    shouldDisplayCart,\r\n    handleCartClick,\r\n    handleCartHover,\r\n    handleCloseCart,\r\n\r\n    redirectToCheckout,\r\n    checkoutSingleItem\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}